!function(o){var d=function(t){t.$menu=o("<div />"),t.$menu.$header=o('<a title="'+wpfdparams.columns+'" />'),t.$menu.$list=o("<ul />"),t.$menu.addClass("mediaTableMenu").addClass("mediaTableMenuClosed").append(t.$menu.$header).append(t.$menu.$list),t.$wrap.addClass("mediaTableWrapperWithMenu"),t.$menu.$header.html(t.cfg.menuTitle),t.$table.before(t.$menu),o(window).bind("orientationchange resize",function(){t.$menu.find("input").trigger("updateCheck")}),t.$menu.$header.bind("click",function(){t.$menu.toggleClass("mediaTableMenuClosed")}),t.$table.click(function(){t.$menu.addClass("mediaTableMenuClosed")}),t.$menu.$list.bind("mouseleave",function(e){t.$menu.toggleClass("mediaTableMenuClosed"),e.stopPropagation()})},i=function(e,t){var a=o(this),n=a.attr("id"),d=a.attr("class");if(n||(n=t.id+"-mediaTableCol-"+e,a.attr("id",n)),t.cfg.menu&&!a.is(".persist")){var i=o('<li><input type="checkbox" name="toggle-cols" id="toggle-col-'+t.id+"-"+e+'" value="'+n+'" /> <label for="toggle-col-'+t.id+"-"+e+'">'+a.text()+"</label></li>");t.$menu.$list.append(i),c(a,i.find("input"),t)}o("tbody tr:not(.nohide)",t.$table).each(function(){l.call(this,e,n,d)}),o("tbody",t.$table).on("change",function(){o("tbody tr:not(.nohide)",t.$table).each(function(){l.call(this,e,n,d)})})},l=function(e,t,a){var n=o(this).find("td,th").eq(e);n.attr("headers",t),a&&n.addClass(a)},c=function(e,a,n){a.bind("change",function(){var e=a.val(),t=n.$table.find("#"+e+", [headers="+e+"]");a.is(":checked")?t.show():t.hide()}).bind("updateCheck",function(){e.is(":visible")?a.attr("checked",!0):a.attr("checked",!1)}).trigger("updateCheck")};o.fn.mediaTable=function(){var t=!1;if(arguments.length&&!o.isPlainObject(arguments[0])||(t=o.extend({},{menu:!0,menuTitle:'<i class="zmdi zmdi-settings"></i>',t:"e"},arguments[0])),!1!==t)o(this).each(function(e){(function(e,t){var a=o(this),n=a.data("MediaTable");o.isEmptyObject(n)&&((n={$wrap:o("<div>"),$table:a,$menu:!1,cfg:e,id:a.attr("id")}).id||(n.id="MediaTable-"+t,n.$table.attr("id",n.id)),n.$table.addClass("activeMediaTable"),n.$wrap.addClass("mediaTableWrapper"),n.$table.before(n.$wrap).appendTo(n.$wrap),n.cfg.menu&&d(n),n.$table.find("thead th").each(function(e){i.call(this,e,n)}),n.$table.data("MediaTable",n))}).call(this,t,e)});else if(arguments.length)switch(arguments[0]){case"destroy":o(this).each(function(){(function(){var e=o(this).data("MediaTable");e&&(e.$wrap.after(e.$table).remove(),e.$table.removeClass("activeMediaTable"),e.$table.data("MediaTable",null))}).call(this)})}return this}}(jQuery),jQuery(document).ready(function(s){var p=s(".wpfd-foldertree-ucftable"),e=window.location.hash,u=s(".wpfd-content-ucftable").data("category"),w={};function g(){s(".wpfd-content-ucftable .catlink").unbind("click").click(function(e){e.preventDefault(),i(s(this).parents(".wpfd-content-ucftable").data("category"),s(this).data("idcat"))})}function m(e,t){var a=".wpfd-content-ucftable.wpfd-content-multi[data-category="+e+"]",n=s(a+" .table-download-category");0===n.length||n.hasClass("display-download-category")||(t?s(a+" .table-download-category").hide():s(a+" .table-download-category").show())}if(s(".wpfd-content-ucftable").each(function(){var t=s(this).data("category");w[t]={parent:0,term_id:t,name:s(this).find("h2").text()},s(this).find(".wpfdcategory.catlink").each(function(){var e=s(this).data("idcat");w[e]={parent:t,term_id:e,name:s(this).text()}}),function(n){s(document).on("change",".wpfd-content-ucftable.wpfd-content-multi[data-category="+n+"] input.cbox_file_download",function(){var e=".wpfd-content-ucftable.wpfd-content-multi[data-category="+n+"]",t=s(e+" input.cbox_file_download:checked"),a=[];(t.length&&t.each(function(e,t){a.push(s(t).data("id"))}),0<a.length)?(s(e+" .wpfdSelectedFiles").remove(),s('<input type="hidden" class="wpfdSelectedFiles" value="'+a.join(",")+'" />').insertAfter(s(e).find(" #current_category_slug")),m(n,!0),s(e+" .table-download-selected").remove(),s('<a href="javascript:void(0);" class="table-download-selected" style="display: block;">'+wpfdparams.translates.download_selected+'<i class="zmdi zmdi-check-all wpfd-download-category"></i></a>').insertAfter(s(e).find("#current_category_slug"))):(s(e+" .wpfdSelectedFiles").remove(),s(e+" .table-download-selected").remove(),m(n,!1))})}(t),function(e){var t=".wpfd-content-ucftable.wpfd-content-multi[data-category="+e+"]";s(document).on("click",t+" .table-download-selected",function(){if(0<s(t).find(".wpfdSelectedFiles").length){var a=s(t).find("#current_category").val(),n=s(t).find("#current_category_slug").val(),e=s(t).find(".wpfdSelectedFiles").val();s.ajax({url:wpfdparams.wpfdajaxurl+"?action=wpfd&task=files.zipSeletedFiles&filesId="+e+"&wpfd_category_id="+a,dataType:"json"}).done(function(e){if(e.success){var t=e.data.hash;window.location.href=wpfdparams.wpfdajaxurl+"?action=wpfd&task=files.downloadZipedFile&hash="+t+"&wpfd_category_id="+a+"&wpfd_category_name="+n}else alert(e.data.message)})}})}(t)}),s(".wpfd-content .mediaTable").mediaTable(),Handlebars.registerHelper("bytesToSize",function(e){return"n/a"===e?e:bytesToSize(parseInt(e))}),g(),""!==(e=e.replace("#",""))){var t=e.split("-"),a=new RegExp("^(p[0-9]+)$"),n=null,d=t.pop();a.test(d)&&(n=d.replace("p",""));var b=t[0];parseInt(b)&&setTimeout(function(){i(s(".wpfd-content-ucftable").data("category"),b,n)},100)}function i(o,l,c){var r=window.location.href.replace(window.location.hash,""),f=s(".wpfd-content-ucftable.wpfd-content-multi[data-category="+o+"]");f.find("#current_category").val(l),f.next(".wpfd-pagination").remove(),s(".wpfd-content-multi[data-category="+o+"] table tbody").empty(),s(".wpfd-content-multi[data-category="+o+"] table").after(s("#wpfd-loading-wrap").html()),s(".wpfd-content-multi[data-category="+o+"] .wpfd-categories").empty(),s.ajax({url:wpfdparams.wpfdajaxurl+"task=categories.display&view=categories&id="+l+"&top="+o,dataType:"json"}).done(function(d){null!=c?window.history.pushState("",document.title,r+"#"+l+"-"+d.category.slug+"-p"+c):window.history.pushState("",document.title,r+"#"+l+"-"+d.category.slug),f.find("#current_category_slug").val(d.category.slug);var e=f.parents().find("#wpfd-template-ucftable-categories-"+o).html(),t=Handlebars.compile(e)(d);if(s(".wpfd-content-multi[data-category="+o+"] .wpfd-categories").prepend(t),p.length){var a=f.find(".wpfd-foldertree-ucftable");a.find("li").removeClass("selected"),a.find("i.md").removeClass("md-folder-open").addClass("md-folder"),a.jaofiletree("open",l,a);var n=a.find('a[data-file="'+l+'"]').parent();n.find(" > i.md").removeClass("md-folder").addClass("md-folder-open"),n.hasClass("selected")||n.addClass("selected");var i=a.find(".icon-open-close");s.each(i.get().reverse(),function(e,t){void 0!==s(t).data()&&s(t).data("id")==Number(b)&&(b=s(t).data("parent_id"),s(t).click())})}s.ajax({url:wpfdparams.wpfdajaxurl+"task=files.display&view=files&id="+l+"&rootcat="+u+"&page="+c,dataType:"json"}).done(function(e){e.files.length?f.find(".table-download-category").removeClass("display-download-category"):f.find(".table-download-category").addClass("display-download-category"),s(".wpfd-content-multi[data-category="+o+"]").after(e.pagination),delete e.pagination;var t=f.parents().find("#wpfd-template-ucftable-"+o).html(),a=Handlebars.compile(t)(e);s(".wpfd-content-multi[data-category="+o+"] table tbody").append(a),s(".wpfd-content-multi[data-category="+o+"] table tbody").trigger("change"),s(".wpfd-content-multi[data-category="+o+"] .mediaTableMenu").find("input").trigger("change");for(var n=0;n<d.categories.length;n++)w[d.categories[n].term_id]=d.categories[n];!function(e,t,a){var n=[],d=w[t];if(!d)return s(".wpfd-content-ucftable[data-category="+e+"] .table-download-category").attr("href",a.linkdownload_cat);if(n.unshift(d),0!==d.parent)for(;w[d.parent];)d=w[d.parent],n.unshift(d);for(var i="",o=0;o<n.length;o++)o<n.length-1?i+='<li><a class="catlink" data-idcat="'+n[o].term_id+'" href="javascript:void(0)">'+n[o].name+'</a><span class="divider"> &gt; </span></li>':i+="<li><span>"+n[o].name+"</span></li>";s(".wpfd-content-ucftable[data-category="+e+"] .wpfd-breadcrumbs-ucftable li").remove(),s(".wpfd-content-ucftable[data-category="+e+"] .wpfd-breadcrumbs-ucftable").append(i),s(".wpfd-content-ucftable[data-category="+e+"] .table-download-category").attr("href",a.linkdownload_cat)}(o,l,d.category),g(),"undefined"!=typeof wpfdColorboxInit&&wpfdColorboxInit(),wpfdTrackDownload(),h(s(".wpfd-pagination")),wpfd_remove_loading(s(".wpfd-content-multi")),s(".wpfd-content-ucftable.wpfd-content-multi[data-category="+o+"] .wpfdSelectedFiles").remove(),s(".wpfd-content-ucftable.wpfd-content-multi[data-category="+o+"] .table-download-selected").remove(),m(o,!1)})})}function h(e){var t=e.find("a:not(.current)"),d=e.prev(".wpfd-content-ucftable"),i=d.find("#current_category").val(),o=d.data("category");t.unbind("click").bind("click",function(){var e=s(this).attr("data-page");if(void 0!==e){var t=window.location.href.replace(window.location.hash,""),a=s(".wpfd-content-multi[data-category="+o+"]").find("#current_category").val(),n=s(".wpfd-content-multi[data-category="+o+"]").find("#current_category_slug").val();window.history.pushState("",document.title,t+"#"+a+"-"+n+"-p"+e),s(".wpfd-content-multi[data-category="+o+"] table tbody tr:not(.topheader)").remove(),s(".wpfd-content-multi[data-category="+o+"] table").after(s("#wpfd-loading-wrap").html()),s.ajax({url:wpfdparams.wpfdajaxurl+"task=files.display&view=files&id="+i+"&rootcat="+o+"&page="+e,dataType:"json",beforeSend:function(){s("html, body").animate({scrollTop:s(".wpfd-content-ucftable").offset().top},"fast")}}).done(function(e){delete e.category,d.next(".wpfd-pagination").remove(),d.after(e.pagination),delete e.pagination;var t=d.parents().find("#wpfd-template-ucftable-"+o).html(),a=Handlebars.compile(t)(e);s(".wpfd-content-multi[data-category="+o+"] table tbody").append(a),s(".wpfd-content-multi[data-category="+o+"] table tbody").trigger("change"),s(".wpfd-content-multi[data-category="+o+"] .mediaTableMenu").find("input").trigger("change"),"undefined"!=typeof wpfdColorboxInit&&wpfdColorboxInit(),h(d.next(".wpfd-pagination")),wpfd_remove_loading(s(".wpfd-content-multi"))})}})}p.length&&p.each(function(){var e=s(this).parents(".wpfd-content-ucftable.wpfd-content-multi").data("category");s(this).jaofiletree({script:wpfdparams.wpfdajaxurl+"task=categories.getCats",usecheckboxes:!1,root:e,showroot:w[e].name,onclick:function(e,t){var a=s(e).parents(".wpfd-content-ucftable.wpfd-content-multi").data("category");a!==t&&s(e).parents(".directory").each(function(){var e=s(this),t=e.find(" > a"),a=e.find(".icon-open-close");0<a.length&&void 0===w[t.data("file")]&&(w[t.data("file")]={parent:a.data("parent_id"),term_id:t.data("file"),name:t.text()})}),i(a,t)}})}),s(".wpfd-pagination").each(function(){h(s(this))})});