jQuery(document).ready(function(p){var s=p(".wpfd-foldertree-ucftable"),t=window.location.hash,w=p(".wpfd-content-ucftable").data("category"),u={};function g(){p(".wpfd-content-ucftable .catlink").unbind("click").click(function(t){t.preventDefault(),o(p(this).parents(".wpfd-content-ucftable").data("category"),p(this).data("idcat"))})}function m(t,e){var a=".wpfd-content-ucftable.wpfd-content-multi[data-category="+t+"]",n=p(a+" .table-download-category");0===n.length||n.hasClass("display-download-category")||(e?p(a+" .table-download-category").hide():p(a+" .table-download-category").show())}if(p(".wpfd-content-ucftable").each(function(){var e=p(this).data("category");u[e]={parent:0,term_id:e,name:p(this).find("h2").text()},p(this).find(".wpfdcategory.catlink").each(function(){var t=p(this).data("idcat");u[t]={parent:e,term_id:t,name:p(this).text()}}),function(n){p(document).on("change",".wpfd-content-ucftable.wpfd-content-multi[data-category="+n+"] input.cbox_file_download",function(){var t=".wpfd-content-ucftable.wpfd-content-multi[data-category="+n+"]",e=p(t+" input.cbox_file_download:checked"),a=[];(e.length&&e.each(function(t,e){a.push(p(e).data("id"))}),0<a.length)?(p(t+" .wpfdSelectedFiles").remove(),p('<input type="hidden" class="wpfdSelectedFiles" value="'+a.join(",")+'" />').insertAfter(p(t).find(" #current_category_slug")),m(n,!0),p(t+" .table-download-selected").remove(),p('<a href="javascript:void(0);" class="table-download-selected" style="display: block;">'+wpfdparams.translates.download_selected+'<i class="zmdi zmdi-check-all wpfd-download-category"></i></a>').insertAfter(p(t).find("#current_category_slug"))):(p(t+" .wpfdSelectedFiles").remove(),p(t+" .table-download-selected").remove(),m(n,!1))})}(e),function(t){var e=".wpfd-content-ucftable.wpfd-content-multi[data-category="+t+"]";p(document).on("click",e+" .table-download-selected",function(){if(0<p(e).find(".wpfdSelectedFiles").length){var a=p(e).find("#current_category").val(),n=p(e).find("#current_category_slug").val(),t=p(e).find(".wpfdSelectedFiles").val();p.ajax({url:wpfdparams.wpfdajaxurl+"?action=wpfd&task=files.zipSeletedFiles&filesId="+t+"&wpfd_category_id="+a,dataType:"json"}).done(function(t){if(t.success){var e=t.data.hash;window.location.href=wpfdparams.wpfdajaxurl+"?action=wpfd&task=files.downloadZipedFile&hash="+e+"&wpfd_category_id="+a+"&wpfd_category_name="+n}else alert(t.data.message)})}})}(e)}),Handlebars.registerHelper("bytesToSize",function(t){return"n/a"===t?t:bytesToSize(parseInt(t))}),g(),""!==(t=t.replace("#",""))){var e=t.split("-"),a=new RegExp("^(p[0-9]+)$"),n=null,d=e.pop();a.test(d)&&(n=d.replace("p",""));var y=e[0];parseInt(y)&&setTimeout(function(){o(p(".wpfd-content-ucftable").data("category"),y,n)},100)}function o(l,i,c){var r=window.location.href.replace(window.location.hash,""),f=p(".wpfd-content-ucftable.wpfd-content-multi[data-category="+l+"]");f.find("#current_category").val(i),f.next(".wpfd-pagination").remove(),p(".wpfd-content-multi[data-category="+l+"] table tbody").empty(),p(".wpfd-content-multi[data-category="+l+"] table").after(p("#wpfd-loading-wrap").html()),p(".wpfd-content-multi[data-category="+l+"] .wpfd-categories").empty(),p.ajax({url:wpfdparams.wpfdajaxurl+"task=categories.display&view=categories&id="+i+"&top="+l,dataType:"json"}).done(function(d){null!=c?window.history.pushState("",document.title,r+"#"+i+"-"+d.category.slug+"-p"+c):window.history.pushState("",document.title,r+"#"+i+"-"+d.category.slug),f.find("#current_category_slug").val(d.category.slug);var t=f.parents().find("#wpfd-template-ucftable-categories-"+l).html(),e=Handlebars.compile(t)(d);if(p(".wpfd-content-multi[data-category="+l+"] .wpfd-categories").prepend(e),s.length){var a=f.find(".wpfd-foldertree-ucftable");a.find("li").removeClass("selected"),a.find("i.md").removeClass("md-folder-open").addClass("md-folder"),a.jaofiletree("open",i,a);var n=a.find('a[data-file="'+i+'"]').parent();n.find(" > i.md").removeClass("md-folder").addClass("md-folder-open"),n.hasClass("selected")||n.addClass("selected");var o=a.find(".icon-open-close");p.each(o.get().reverse(),function(t,e){void 0!==p(e).data()&&p(e).data("id")==Number(y)&&(y=p(e).data("parent_id"),p(e).click())})}p.ajax({url:wpfdparams.wpfdajaxurl+"task=files.display&view=files&id="+i+"&rootcat="+w+"&page="+c,dataType:"json"}).done(function(t){t.files.length?(f.find(".table-download-category").removeClass("display-download-category"),f.find(".hide-empty").removeClass("hide")):(f.find(".table-download-category").addClass("display-download-category"),f.find(".hide-empty").addClass("hide")),p(".wpfd-content-multi[data-category="+l+"]").after(t.pagination),delete t.pagination;var e=f.parents().find("#wpfd-template-ucftable-"+l).html(),a=Handlebars.compile(e)(t);p(".wpfd-content-multi[data-category="+l+"] table tbody").append(a),p(".wpfd-content-multi[data-category="+l+"] table tbody").trigger("change");for(var n=0;n<d.categories.length;n++)u[d.categories[n].term_id]=d.categories[n];!function(t,e,a){var n=[],d=u[e];if(!d)return p(".wpfd-content-ucftable[data-category="+t+"] .table-download-category").attr("href",a.linkdownload_cat);if(n.unshift(d),0!==d.parent)for(;u[d.parent];)d=u[d.parent],n.unshift(d);for(var o="",l=0;l<n.length;l++)l<n.length-1?o+='<li><a class="catlink" data-idcat="'+n[l].term_id+'" href="javascript:void(0)">'+n[l].name+'</a><span class="divider"> &gt; </span></li>':o+="<li><span>"+n[l].name+"</span></li>";p(".wpfd-content-ucftable[data-category="+t+"] .wpfd-breadcrumbs-ucftable li").remove(),p(".wpfd-content-ucftable[data-category="+t+"] .wpfd-breadcrumbs-ucftable").append(o),p(".wpfd-content-ucftable[data-category="+t+"] .table-download-category").attr("href",a.linkdownload_cat)}(l,i,d.category),g(),"undefined"!=typeof wpfdColorboxInit&&wpfdColorboxInit(),wpfdTrackDownload(),h(p(".wpfd-pagination")),wpfd_remove_loading(p(".wpfd-content-multi")),p(".wpfd-content-ucftable.wpfd-content-multi[data-category="+l+"] .wpfdSelectedFiles").remove(),p(".wpfd-content-ucftable.wpfd-content-multi[data-category="+l+"] .table-download-selected").remove(),m(l,!1)})})}function h(t){var e=t.find("a:not(.current)"),d=t.prev(".wpfd-content-ucftable"),o=d.find("#current_category").val(),l=d.data("category");e.unbind("click").bind("click",function(){var t=p(this).attr("data-page");if(void 0!==t){var e=window.location.href.replace(window.location.hash,""),a=p(".wpfd-content-multi[data-category="+l+"]").find("#current_category").val(),n=p(".wpfd-content-multi[data-category="+l+"]").find("#current_category_slug").val();window.history.pushState("",document.title,e+"#"+a+"-"+n+"-p"+t),p(".wpfd-content-multi[data-category="+l+"] table tbody tr:not(.topheader)").remove(),p(".wpfd-content-multi[data-category="+l+"] table").after(p("#wpfd-loading-wrap").html()),p.ajax({url:wpfdparams.wpfdajaxurl+"task=files.display&view=files&id="+o+"&rootcat="+l+"&page="+t,dataType:"json",beforeSend:function(){p("html, body").animate({scrollTop:p(".wpfd-content-ucftable").offset().top},"fast")}}).done(function(t){delete t.category,d.next(".wpfd-pagination").remove(),d.after(t.pagination),delete t.pagination;var e=d.parents().find("#wpfd-template-ucftable-"+l).html(),a=Handlebars.compile(e)(t);p(".wpfd-content-multi[data-category="+l+"] table tbody").append(a),p(".wpfd-content-multi[data-category="+l+"] table tbody").trigger("change"),"undefined"!=typeof wpfdColorboxInit&&wpfdColorboxInit(),h(d.next(".wpfd-pagination")),wpfd_remove_loading(p(".wpfd-content-multi"))})}})}s.length&&s.each(function(){var t=p(this).parents(".wpfd-content-ucftable.wpfd-content-multi").data("category");p(this).jaofiletree({script:wpfdparams.wpfdajaxurl+"task=categories.getCats",usecheckboxes:!1,root:t,showroot:u[t].name,onclick:function(t,e){var a=p(t).parents(".wpfd-content-ucftable.wpfd-content-multi").data("category");a!==e&&p(t).parents(".directory").each(function(){var t=p(this),e=t.find(" > a"),a=t.find(".icon-open-close");0<a.length&&void 0===u[e.data("file")]&&(u[e.data("file")]={parent:a.data("parent_id"),term_id:e.data("file"),name:e.text()})}),o(a,e)}})}),p(".wpfd-pagination").each(function(){h(p(this))})});